<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kingdom Post</title>
  <script src="https://cdn.jsdelivr.net/npm/marked@14.0.0/marked.min.js"></script>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f8f7f4;
      color: #2c2c2c;
      line-height: 1.6;
    }

    /* ── Header ── */
    header {
      background: #fff;
      border-bottom: 1px solid #e5e2dc;
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      color: #1a1a1a;
      max-width: 1400px;
      margin: 0 auto;
    }

    header h1 span {
      font-weight: 300;
      color: #7a7568;
    }

    /* ── Layout ── */
    .container {
      display: flex;
      max-width: 1400px;
      margin: 0 auto;
      min-height: 100vh;
    }

    /* ── Article Reader (left) ── */
    .reader {
      flex: 2;
      padding: 2.5rem 3rem;
      border-right: 1px solid #e5e2dc;
      overflow-y: auto;
      max-height: 100vh;
    }

    .reader-meta {
      font-size: 0.85rem;
      color: #8a8578;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #e5e2dc;
    }

    .reader-meta .author { font-weight: 500; color: #5a5549; }

    .reader-content h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 0.5rem; line-height: 1.3; color: #1a1a1a; }
    .reader-content h2 { font-size: 1.35rem; font-weight: 600; margin-top: 2rem; margin-bottom: 0.75rem; color: #2c2c2c; }
    .reader-content h3 { font-size: 1.1rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #3a3a3a; }
    .reader-content p { margin-bottom: 1rem; font-size: 1.05rem; }
    .reader-content blockquote {
      border-left: 3px solid #c4bfb4;
      padding: 0.5rem 1rem;
      margin: 1.25rem 0;
      color: #5a5549;
      font-style: italic;
      background: #f0eee8;
      border-radius: 0 4px 4px 0;
    }
    .reader-content a { color: #4a6741; text-decoration: underline; }
    .reader-content a:hover { color: #2e4228; }
    .reader-content hr { border: none; border-top: 1px solid #e5e2dc; margin: 1.5rem 0; }
    .reader-content img { max-width: 100%; border-radius: 6px; margin: 1rem 0; }
    .reader-content strong { font-weight: 600; }
    .reader-content em { font-style: italic; }
    .reader-content sub { font-size: 0.8rem; color: #8a8578; }

    /* ── Sidebar (right) ── */
    .sidebar {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      max-height: calc(100vh - 56px);
      background: #fff;
    }

    .sidebar-heading {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #8a8578;
      margin-bottom: 1rem;
    }

    .blog-card {
      display: flex;
      gap: 0.85rem;
      padding: 0.85rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.15s ease;
      border: 1px solid transparent;
      margin-bottom: 0.5rem;
    }

    .blog-card:hover { background: #f8f7f4; }
    .blog-card.active { background: #f0eee8; border-color: #d5d0c6; }

    .blog-card-thumb {
      width: 72px;
      height: 72px;
      border-radius: 6px;
      object-fit: cover;
      flex-shrink: 0;
      background: #e5e2dc;
    }

    .blog-card-info { display: flex; flex-direction: column; justify-content: center; min-width: 0; }

    .blog-card-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #1a1a1a;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .blog-card-meta {
      font-size: 0.75rem;
      color: #8a8578;
      margin-top: 0.3rem;
    }

    /* ── Loading state ── */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: #8a8578;
      font-size: 0.95rem;
    }

    /* ── Responsive ── */
    @media (max-width: 768px) {
      .container { flex-direction: column-reverse; }
      .reader {
        border-right: none;
        border-top: 1px solid #e5e2dc;
        padding: 1.5rem;
        max-height: none;
      }
      .sidebar {
        max-height: none;
        border-bottom: 1px solid #e5e2dc;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Kingdom <span>Post</span></h1>
  </header>

  <div class="container">
    <main class="reader">
      <div class="loading">Loading...</div>
    </main>
    <aside class="sidebar">
      <div class="sidebar-heading">Articles</div>
      <div id="blog-list"></div>
    </aside>
  </div>

  <script>
    const blogList = document.getElementById('blog-list');
    const reader = document.querySelector('.reader');
    let blogs = [];
    let activeFile = null;

    function parseFrontmatter(text) {
      text = text.replace(/\r\n/g, '\n');
      const match = text.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
      if (!match) return { meta: {}, body: text };
      const meta = {};
      match[1].split('\n').forEach(line => {
        const idx = line.indexOf(':');
        if (idx > -1) {
          const key = line.slice(0, idx).trim();
          const val = line.slice(idx + 1).trim().replace(/^["']|["']$/g, '');
          meta[key] = val;
        }
      });
      return { meta, body: match[2] };
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr + 'T00:00:00');
      if (isNaN(d.getTime())) return '';
      return d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
    }

    function renderBlogList() {
      blogList.innerHTML = '';
      blogs.forEach(blog => {
        const card = document.createElement('div');
        card.className = 'blog-card' + (blog.file === activeFile ? ' active' : '');
        card.innerHTML =
          '<img class="blog-card-thumb" src="' + blog.image + '" alt="" />' +
          '<div class="blog-card-info">' +
            '<div class="blog-card-title">' + blog.title + '</div>' +
            '<div class="blog-card-meta">' + formatDate(blog.date) + ' &middot; ' + blog.author + '</div>' +
          '</div>';
        card.addEventListener('click', function() { loadBlog(blog.file); });
        blogList.appendChild(card);
      });
    }

    // Use whichever marked API is available
    function renderMarkdown(text) {
      if (typeof marked.parse === 'function') return marked.parse(text);
      if (typeof marked === 'function') return marked(text);
      return '<p>' + text + '</p>';
    }

    // Fallback URL for raw blog content via GitHub CDN
    var RAW_BASE = 'https://raw.githubusercontent.com/WRyan77/kingdom-post/main/';

    function fetchBlogFile(file) {
      return fetch(file).then(function(r) {
        if (r.ok) return r.text();
        // Direct fetch failed — try GitHub raw content CDN as fallback
        return fetch(RAW_BASE + file).then(function(r2) {
          if (!r2.ok) throw new Error('Failed to load: ' + r2.status);
          return r2.text();
        });
      });
    }

    function displayBlog(text, blogInfo) {
      var parsed = parseFrontmatter(text);
      var meta = parsed.meta;
      var body = parsed.body;
      var html = renderMarkdown(body);

      var author = meta.author || blogInfo.author || '';
      var date = meta.date || blogInfo.date || '';

      reader.innerHTML =
        '<div class="reader-meta">' +
          '<span class="author">' + author + '</span>' +
          (date ? ' &middot; ' + formatDate(date) : '') +
        '</div>' +
        '<div class="reader-content">' + html + '</div>';
    }

    function loadBlog(file) {
      activeFile = file;
      renderBlogList();
      reader.innerHTML = '<div class="loading">Loading...</div>';

      // Get metadata from blogs.json as fallback
      var blogInfo = blogs.find(function(b) { return b.file === file; }) || {};

      fetchBlogFile(file)
        .then(function(text) { displayBlog(text, blogInfo); })
        .catch(function(err) {
          reader.innerHTML =
            '<div class="reader-meta">' +
              '<span class="author">' + (blogInfo.author || '') + '</span>' +
              (blogInfo.date ? ' &middot; ' + formatDate(blogInfo.date) : '') +
            '</div>' +
            '<div class="reader-content"><p>Could not load article. ' + err.message + '</p></div>';
        });
    }

    // Init
    fetch('blogs.json')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        blogs = data;
        renderBlogList();
        if (blogs.length > 0) {
          loadBlog(blogs[0].file);
        }
      });
  </script>
</body>
</html>
